# 🛡️ Network Monitor & Attack Detector – مشروع تخرج متكامل

أداة ذكية لمراقبة الشبكة الحيّة، كشف هجمات الطبقة الثانية والثالثة، بثّ تنبيهات في الوقت الحقيقي، وعرض لوحة تحكم مباشرة عبر الويب.

## 🚀 المميزات

* التقاط الحزم مباشرة باستخدام Scapy
* كشف تلقائي لهجمات:

  * ARP Spoofing
  * DNS Spoofing
  * Port Scanning (TCP SYN flood)
  * DHCP Starvation
  * MAC Flooding
  * الاتصالات مع منافذ مشبوهة (مثل 4444)
* لوحة تحكم ويب مبنية بـ Flask + WebSocket
* تنبيهات لحظية عبر Telegram Bot
* مصادقة HTTP أساسية للوصول للواجهة
* ملف إعدادات YAML قابل للتخصيص بالكامل
* مثال ملف Systemd لتشغيل الأداة كخدمة دائمة
* لا يتطلب قاعدة بيانات (يُسجل كل شيء في `network_monitor.log`)

---

## ⚙️ المتطلبات

* Python 3.8+
* صلاحيات `sudo` (أو `CAP_NET_RAW`)
* مكتبات Python:

  ```bash
  pip install -r requirements.txt
  ```

  أو:

  ```bash
  pip install scapy flask flask-socketio pyyaml requests
  ```

---

## 🧠 مبدأ العمل

1. يقوم البرنامج بالتقاط الحزم من واجهة الشبكة المحددة (wlan0 أو eth0...)
2. كل حزمة تمر عبر مجموعة من الكواشف (Plugins)
3. عند رصد هجمة أو حالة مشبوهة، يتم تسجيل تنبيه وإرساله عبر القنوات المفعّلة (مثل Telegram)
4. يتم بث التنبيهات مباشرة إلى لوحة الويب عبر WebSocket
5. يتم تحديث قائمة الأجهزة المكتشفة دوريًا بمسح ARP كل 60 ثانية (قابلة للتعديل)

---

## 🧪 التشغيل السريع

### 1. تهيئة ملف الإعدادات `config.yaml`

```yaml
interface: wlan0  # غيّرها حسب جهازك
scan_interval: 60
web_port: 5000
suspect_ports: [4444,1337,5555]
auth:
  username: admin
  password: changeme
telegram:
  token: "123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11"
  chat_id: "123456789"
alert_channels: ["telegram"]
throttle_window: 5  # ثوانٍ بين نفس التنبيه لتجنب الإغراق
```

> 📌 يمكنك تجاوز القيم عبر متغيرات بيئة:

```bash
export TELEGRAM_TOKEN=...
export TELEGRAM_CHAT_ID=...
```

### 2. تشغيل البرنامج

```bash
sudo python3 network_monitor.py wlan0
```

### 3. الدخول للوحة المراقبة

افتح المتصفح:

```
http://<IP-جهازك>:5000
```

استخدم بيانات الدخول:

* اسم المستخدم: `admin`
* كلمة المرور: `changeme`

---

## 📡 ربط Telegram Bot

1. افتح تطبيق Telegram وابحث عن `@BotFather`
2. أرسل إليه الأمر:

```
/newbot
```

3. اتبع التعليمات واختر اسمًا ورابطًا للبوت
4. سيعطيك توكن مثل:

```
123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
```

5. أرسل رسالة للبوت من حسابك الشخصي (أي رسالة)
6. افتح هذا الرابط:

```
https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates
```

7. ستجد `chat.id` الخاص بك (عادة رقم طويل)
8. ضع الـ token والـ chat\_id في `config.yaml`

---

## 🛠️ محتوى الكود

* `network_monitor.py` → الملف الرئيسي، كل الوظائف موجودة فيه
* `config.yaml` → إعدادات مخصصة
* `network_monitor.log` → سجل تنبيهات ونشاط الأداة
* `netmon.service` → مثال ملف systemd لتشغيل الخدمة تلقائيًا

---

## 🧩 الهجمات التي يكشفها

| الهجوم          | طريقة الكشف                                          |
| --------------- | ---------------------------------------------------- |
| ARP Spoofing    | مقارنة الـ MAC الحالي للـ IP مع السابق               |
| DNS Spoofing    | مقارنة الـ DNS Response الجديد بالقيم المخزنة سابقًا |
| Port Scan       | >30 SYN في 10 ثواني من نفس المصدر                    |
| DHCP Starvation | أكثر من 15 طلب DHCP من نفس MAC                       |
| MAC Flooding    | >200 عنوان MAC جديد خلال 10 ثواني                    |
| منافذ مشبوهة    | أي اتصال وارد/صادر من منافذ محددة (مثل 4444)         |

---

## 🔐 حماية الواجهة

* يتم طلب Basic Authentication لأي طلب
* يمكنك تغيير المستخدم/كلمة المرور من `config.yaml`

---

## 🔁 تشغيل تلقائي مع النظام (Linux)

1. شغّل السكربت مرة واحدة لإنشاء `netmon.service`
2. انسخه إلى مجلد systemd:

```bash
sudo cp netmon.service /etc/systemd/system/
```

3. فعّله وشغّله:

```bash
sudo systemctl enable netmon
sudo systemctl start netmon
```

---

## 💬 للمساهمة أو التطوير

مرحبًا بأي تطوير إضافي للأداة:

* دعم واجهة React كاملة
* تنبيهات عبر البريد الإلكتروني / Slack / Discord
* إضافة رسوم بيانية حيّة
* دعم TLS للوحة الويب

---

## 🧯 ملاحظات أمنية

* لا تشغّل الأداة على شبكة لا تملكها أو دون تصريح
* الأداة تهدف للحماية والاختبار فقط (Ethical Use)
* تأكد من ضبط الجدار الناري لإغلاق المنافذ المفتوحة غير المستخدمة (مثل 8022)

---

## ✅ تم بنجاح!

بمجرد تشغيل الأداة، ستراقب الشبكة وتقوم بتنبيهك فورًا عند أي نشاط مشبوه.
صفحة الويب تعرض كل التنبيهات والأجهزة مباشرة، ويمكنك تعديل الكواشف كما يناسب مشروعك أو بيئتك.

> بالتوفيق في مشروع التخرج 🎓 — أي تطوير أو سؤال، أنا هنا دائمًا! 💡
